# ğŸ” API å‚æ•°è¯¦ç»†è§£ç­”

## ä½ çš„é—®é¢˜è§£ç­”

---

## 1ï¸âƒ£ `search_depth: "advanced"` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

### å½“å‰å®ç°çŠ¶æ€

**å®è¯å®è¯´**: âš ï¸ **ç›®å‰è¿™ä¸ªå‚æ•°åŸºæœ¬æ²¡æœ‰å®é™…ä½œç”¨**

### åŸå› 

æŸ¥çœ‹ä»£ç å‘ç°ï¼š

```typescript
// route.ts:151
const searchDepth = body.search_depth || CONFIG.DEFAULT_SEARCH_DEPTH;
```

è™½ç„¶å‚æ•°è¢«è¯»å–äº†ï¼Œä½†**æ²¡æœ‰è¢«å®é™…ä½¿ç”¨**åˆ°ä»»ä½•æœç´¢é€»è¾‘ä¸­ã€‚

### Tavily API ä¸­çš„å®šä¹‰

åœ¨æ ‡å‡† Tavily API ä¸­ï¼Œ`search_depth` çš„å«ä¹‰ï¼š

```
basic (é»˜è®¤):
  - å¿«é€Ÿæœç´¢
  - è¿”å›å‰ 5-10 ä¸ªç»“æœ
  - é€‚åˆå¿«é€ŸæŸ¥è¯¢
  - å“åº”æ—¶é—´: 1-3 ç§’

advanced:
  - æ·±åº¦æœç´¢
  - è¿”å›æ›´å¤šç»“æœï¼ˆ20-50 ä¸ªï¼‰
  - æ›´å…¨é¢çš„å†…å®¹æŠ“å–
  - å¯èƒ½è®¿é—®å¤šä¸ªæœç´¢å¼•æ“
  - å“åº”æ—¶é—´: 5-15 ç§’
```

### æˆ‘ä»¬çš„å®ç°

ç›®å‰æˆ‘ä»¬çš„ API é€šè¿‡ **`max_results` å‚æ•°** æ¥æ§åˆ¶è¿™ä¸ªè¡Œä¸ºï¼š

```json
{
  "query": "AI trends",
  "max_results": 5    // ç›¸å½“äº basic
}

{
  "query": "AI trends",
  "max_results": 50   // ç›¸å½“äº advanced
}
```

### å»ºè®®

1. **å½“å‰ä½¿ç”¨**: ä½¿ç”¨ `max_results` æ§åˆ¶ç»“æœæ•°é‡
2. **æœªæ¥ä¼˜åŒ–**: å¯ä»¥å®ç° `search_depth` æ¥è‡ªåŠ¨è®¾ç½®ï¼š
   - `basic` â†’ `max_results = 10`
   - `advanced` â†’ `max_results = 50`

---

## 2ï¸âƒ£ DuckDuckGo æ˜¯ä»€ä¹ˆå¼•æ“ï¼Ÿ

### ç®€ä»‹

**DuckDuckGo** æ˜¯ä¸€ä¸ª**æ³¨é‡éšç§çš„æœç´¢å¼•æ“**ã€‚

### æ ¸å¿ƒç‰¹ç‚¹

#### ğŸ”’ éšç§ä¿æŠ¤

```
âŒ ä¸è¿½è¸ªç”¨æˆ·
âŒ ä¸æ”¶é›†ä¸ªäººä¿¡æ¯
âŒ ä¸å»ºç«‹ç”¨æˆ·ç”»åƒ
âŒ ä¸è®°å½•æœç´¢å†å²
âœ… åŒ¿åæœç´¢
```

#### ğŸŒ æœç´¢æ¥æº

DuckDuckGo ä¸æ˜¯ç‹¬ç«‹çˆ¬è™«ï¼Œè€Œæ˜¯èšåˆå¤šä¸ªæ¥æºï¼š

```
ä¸»è¦æ¥æº:
  - Bing (Microsoft)
  - Yahoo
  - Wikipedia
  - è‡ªå·±çš„çˆ¬è™« DuckDuckBot
  - å…¶ä»–æ•°ç™¾ä¸ªä¸“ä¸šæ¥æº
```

#### ğŸ“Š ä¸å…¶ä»–å¼•æ“å¯¹æ¯”

| ç‰¹æ€§ | Google | Bing | DuckDuckGo |
|------|--------|------|------------|
| ç´¢å¼•å¤§å° | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| æœç´¢è´¨é‡ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| éšç§ä¿æŠ¤ | â­ | â­â­ | â­â­â­â­â­ |
| é€Ÿåº¦ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| å¹¿å‘Šè·Ÿè¸ª | âŒ æœ‰ | âŒ æœ‰ | âœ… æ—  |
| ä¸ªæ€§åŒ– | âœ… æœ‰ | âœ… æœ‰ | âŒ æ—  |

### ä¸ºä»€ä¹ˆä½¿ç”¨ DuckDuckGoï¼Ÿ

#### ä¼˜ç‚¹ âœ…

1. **éšç§ä¿æŠ¤**: ä¸ä¼šæ³„éœ²æœç´¢è®°å½•
2. **æ— è¿‡æ»¤æ°”æ³¡**: æ¯ä¸ªäººçœ‹åˆ°çš„ç»“æœç›¸åŒï¼ˆæ— ä¸ªæ€§åŒ–ï¼‰
3. **å¹²å‡€ç»“æœ**: è¾ƒå°‘å¹¿å‘Šå’Œè¿½è¸ª
4. **API å‹å¥½**: å¯¹è‡ªåŠ¨åŒ–æŸ¥è¯¢æ¯”è¾ƒå®½å®¹

#### ç¼ºç‚¹ âŒ

1. **ç»“æœæ•°é‡**: æ¯” Google å°‘
2. **æœ¬åœ°åŒ–**: æœ¬åœ°æœç´¢ç»“æœä¸å¦‚ Google
3. **å®æ—¶æ€§**: æ–°é—»æ›´æ–°æ¯” Google æ…¢

### åœ¨æˆ‘ä»¬ API ä¸­çš„ä½¿ç”¨

é»˜è®¤é…ç½®ï¼š

```typescript
DEFAULT_ENGINES: ['google', 'bing', 'duckduckgo']
```

**ä¸ºä»€ä¹ˆä¸‰ä¸ªéƒ½ç”¨ï¼Ÿ**

```
Google:
  âœ“ æœ€å…¨é¢çš„ç´¢å¼•
  âœ“ æœ€å¥½çš„ç›¸å…³æ€§ç®—æ³•
  âœ“ æœ€æ–°çš„å†…å®¹

Bing:
  âœ“ å¾®è½¯ç”Ÿæ€ç³»ç»Ÿå†…å®¹
  âœ“ ç‹¬ç‰¹çš„ç´¢å¼•
  âœ“ è‰¯å¥½çš„å›½é™…åŒ–

DuckDuckGo:
  âœ“ éšç§ä¿æŠ¤
  âœ“ æ— åè§çš„ç»“æœ
  âœ“ ä¸“ä¸šæ¥æºèšåˆ

ä¸‰è€…ç»“åˆ â†’ æœ€å…¨é¢çš„æœç´¢ç»“æœï¼
```

### å•ç‹¬ä½¿ç”¨ DuckDuckGo

å¦‚æœä½ åªæƒ³ç”¨ DuckDuckGoï¼š

```json
{
  "query": "privacy-focused email",
  "engines": ["duckduckgo"]
}
```

**é€‚ç”¨åœºæ™¯**:
- éšç§æ•æ„Ÿæœç´¢
- é¿å…æœç´¢å†å²å½±å“
- éœ€è¦ä¸­ç«‹çš„æœç´¢ç»“æœ

---

## 3ï¸âƒ£ SafeSearch æ˜¯å¹²å˜›çš„ï¼Ÿ

### åŠŸèƒ½è¯´æ˜

**SafeSearchï¼ˆå®‰å…¨æœç´¢ï¼‰** æ˜¯ç”¨æ¥**è¿‡æ»¤æˆäºº/ä¸é€‚å½“å†…å®¹**çš„åŠŸèƒ½ã€‚

### å·¥ä½œåŸç†

```
æœç´¢æŸ¥è¯¢ â†’ æœç´¢å¼•æ“ â†’ SafeSearch è¿‡æ»¤å™¨ â†’ è¿”å›ç»“æœ
                              â†“
                    æ ¹æ®çº§åˆ«è¿‡æ»¤ä¸é€‚å½“å†…å®¹
```

### ä¸‰ä¸ªçº§åˆ«

#### çº§åˆ« 0: å…³é—­ (Off)

```
è®¾ç½®: "safesearch": 0

è¡Œä¸º:
  âŒ ä¸è¿‡æ»¤ä»»ä½•å†…å®¹
  âœ… è¿”å›æ‰€æœ‰æœç´¢ç»“æœ
  âš ï¸ å¯èƒ½åŒ…å«æˆäººå†…å®¹

é€‚ç”¨:
  - æˆäººç”¨æˆ·
  - å­¦æœ¯ç ”ç©¶
  - å®Œå…¨ä¸éœ€è¦è¿‡æ»¤çš„åœºæ™¯
```

#### çº§åˆ« 1: ä¸­ç­‰ (Moderate)

```
è®¾ç½®: "safesearch": 1

è¡Œä¸º:
  âš ï¸ è¿‡æ»¤æ˜æ˜¾çš„æˆäººå†…å®¹
  âš ï¸ è¿‡æ»¤è‰²æƒ…å›¾ç‰‡
  âœ… ä¿ç•™å¯èƒ½æœ‰äº‰è®®çš„å†…å®¹
  âœ… ä¿ç•™æ•™è‚²/åŒ»ç–—å†…å®¹

é€‚ç”¨:
  - ä¸€èˆ¬æˆäººç”¨æˆ·
  - å·¥ä½œç¯å¢ƒ
  - å¹³è¡¡è¿‡æ»¤éœ€æ±‚
```

#### çº§åˆ« 2: ä¸¥æ ¼ (Strict) â­ é»˜è®¤

```
è®¾ç½®: "safesearch": 2

è¡Œä¸º:
  âœ… è¿‡æ»¤æ‰€æœ‰æˆäººå†…å®¹
  âœ… è¿‡æ»¤æš´åŠ›å†…å®¹
  âœ… è¿‡æ»¤èµŒåšå†…å®¹
  âœ… è¿‡æ»¤è‰²æƒ…å›¾ç‰‡å’Œè§†é¢‘
  âš ï¸ å¯èƒ½è¿‡æ»¤æŸäº›åˆæ³•å†…å®¹

é€‚ç”¨:
  - æœªæˆå¹´äºº
  - å­¦æ ¡ç¯å¢ƒ
  - å…¬å…±åœºæ‰€
  - ä¼ä¸šç¯å¢ƒ
  - é»˜è®¤å®‰å…¨é€‰æ‹©
```

### å®é™…ä¾‹å­

#### ç¤ºä¾‹ 1: æœç´¢åŒ»ç–—å†…å®¹

```json
æŸ¥è¯¢: "breast cancer treatment"

safesearch: 0
  â†’ å¯èƒ½åŒ…å«ä¸ç›¸å…³çš„æˆäººå†…å®¹

safesearch: 1
  â†’ åŒ…å«åŒ»ç–—å†…å®¹ï¼Œè¿‡æ»¤ä¸ç›¸å…³çš„æˆäººå†…å®¹ âœ… æ¨è

safesearch: 2
  â†’ å¯èƒ½è¿‡æ»¤æŸäº›åˆæ³•åŒ»ç–—å›¾ç‰‡
```

#### ç¤ºä¾‹ 2: æœç´¢æ¸¸æˆå†…å®¹

```json
æŸ¥è¯¢: "Grand Theft Auto gameplay"

safesearch: 0
  â†’ æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬æš´åŠ›åœºæ™¯

safesearch: 1
  â†’ æ¸¸æˆå†…å®¹ï¼Œè¿‡æ»¤æç«¯æš´åŠ› âœ… æ¨è

safesearch: 2
  â†’ å¯èƒ½è¿‡æ»¤æ¸¸æˆç›¸å…³å†…å®¹
```

#### ç¤ºä¾‹ 3: æ•™è‚²æœç´¢

```json
æŸ¥è¯¢: "human anatomy"

safesearch: 0
  â†’ å¯èƒ½åŒ…å«ä¸é€‚å½“å†…å®¹

safesearch: 1
  â†’ æ•™è‚²å†…å®¹ï¼Œåˆé€‚çš„å›¾ç‰‡ âœ… æ¨è

safesearch: 2
  â†’ å¯èƒ½è¿‡æ»¤æŸäº›æ•™è‚²å›¾ç‰‡
```

### æˆ‘ä»¬çš„é»˜è®¤è®¾ç½®

```typescript
safesearch: 2  // ä¸¥æ ¼æ¨¡å¼
```

**ä¸ºä»€ä¹ˆé€‰æ‹©ä¸¥æ ¼æ¨¡å¼ï¼Ÿ**

```
âœ… æœ€å®‰å…¨çš„é»˜è®¤é€‰é¡¹
âœ… é€‚åˆæ‰€æœ‰ç¯å¢ƒï¼ˆåŒ…æ‹¬ä¼ä¸šã€æ•™è‚²ï¼‰
âœ… é¿å…æ½œåœ¨çš„å†…å®¹é—®é¢˜
âœ… ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´
```

### å¦‚ä½•è°ƒæ•´

#### ç¤ºä¾‹ 1: å…³é—­è¿‡æ»¤

```json
{
  "query": "art photography",
  "safesearch": 0
}
```

#### ç¤ºä¾‹ 2: ä¸­ç­‰è¿‡æ»¤

```json
{
  "query": "game reviews",
  "safesearch": 1
}
```

### æŠ€æœ¯å®ç°

SafeSearch ç”±æœç´¢å¼•æ“æœ¬èº«å®ç°ï¼š

```typescript
// ä¼ é€’ç»™ SearXNG
await searchSearxng(searchQuery, {
  safesearch: safesearch.toString(),  // "0", "1", æˆ– "2"
  // ...
});

// SearXNG å†ä¼ é€’ç»™å„ä¸ªæœç´¢å¼•æ“
Google: &safe=strict
Bing: &adlt=strict
DuckDuckGo: &kp=1
```

### é‡è¦æç¤º

âš ï¸ **SafeSearch ä¸æ˜¯ 100% å‡†ç¡®**

```
è¿‡æ»¤å™¨æ˜¯åŸºäºç®—æ³•çš„ï¼Œå¯èƒ½ï¼š
  - è¯¯æŠ¥: è¿‡æ»¤åˆæ³•å†…å®¹
  - æ¼æŠ¥: æœªèƒ½è¿‡æ»¤æŸäº›ä¸é€‚å½“å†…å®¹

ä¸åº”ä¾èµ–å®ƒä½œä¸ºå”¯ä¸€çš„å†…å®¹æ§åˆ¶æ‰‹æ®µ
```

---

## 4ï¸âƒ£ `api_key` çš„ç”¨é€”

### ä½ çš„é—®é¢˜

> "è¿™é‡Œçš„ api key æ„æ€æ˜¯æˆ‘ä»¬å¯ä»¥å°†è¯¥ç½‘ç«™å¼€æ”¾åˆ°å…¬ç½‘ï¼Œç„¶åç”¨ api key æ¥è¿›è¡Œæƒé™éªŒè¯è°ƒç”¨æœåŠ¡å—ï¼Ÿ"

**å›ç­”**: âœ… **æ˜¯çš„ï¼Œæ­£æ˜¯è¿™ä¸ªæ„æ€ï¼ä½†ç›®å‰è¿˜æ²¡æœ‰å®ç°ã€‚**

### å½“å‰çŠ¶æ€

æŸ¥çœ‹ä»£ç ï¼š

```typescript
// route.ts
api_key?: string;  // API key (optional authentication)

// ä½†æ˜¯ä»£ç ä¸­æ²¡æœ‰å®é™…çš„éªŒè¯é€»è¾‘
```

âš ï¸ **ç›®å‰è¿™ä¸ªå‚æ•°è¢«æ¥å—ï¼Œä½†ä¸ä¼šè¿›è¡Œä»»ä½•éªŒè¯ã€‚**

### è®¡åˆ’ç”¨é€”

è¿™ä¸ªå‚æ•°æ˜¯ä¸ºæœªæ¥çš„**API è®¤è¯ç³»ç»Ÿ**é¢„ç•™çš„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœªæ¥çš„è®¤è¯æµç¨‹                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  å®¢æˆ·ç«¯                                      â”‚
â”‚    â†“                                        â”‚
â”‚  POST /api/tavily                           â”‚
â”‚  {                                          â”‚
â”‚    "query": "...",                          â”‚
â”‚    "api_key": "sk-xxxxx"  â† è®¤è¯å¯†é’¥        â”‚
â”‚  }                                          â”‚
â”‚    â†“                                        â”‚
â”‚  æœåŠ¡å™¨éªŒè¯ api_key                          â”‚
â”‚    â†“                                        â”‚
â”‚  âœ… æœ‰æ•ˆ â†’ å¤„ç†è¯·æ±‚                          â”‚
â”‚  âŒ æ— æ•ˆ â†’ è¿”å› 401 Unauthorized            â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¦‚ä½•å®ç° API Key éªŒè¯

æˆ‘å¯ä»¥å¸®ä½ å®ç°è¿™ä¸ªåŠŸèƒ½ï¼è¿™æ˜¯å®ç°æ–¹æ¡ˆï¼š

#### æ–¹æ¡ˆ 1: ç®€å•çš„ç¯å¢ƒå˜é‡éªŒè¯

```typescript
// åœ¨ route.ts ä¸­æ·»åŠ 
const VALID_API_KEYS = process.env.API_KEYS?.split(',') || [];

export const POST = async (req: Request) => {
  const body: TavilySearchRequest = await req.json();
  
  // å¦‚æœé…ç½®äº† API keysï¼Œåˆ™è¿›è¡ŒéªŒè¯
  if (VALID_API_KEYS.length > 0) {
    if (!body.api_key || !VALID_API_KEYS.includes(body.api_key)) {
      return Response.json(
        { 
          error: 'Invalid API key',
          message: 'Please provide a valid API key'
        },
        { status: 401 }
      );
    }
  }
  
  // ç»§ç»­å¤„ç†è¯·æ±‚...
}
```

**é…ç½®** (åœ¨ `k8s/deployment.yaml`):

```yaml
env:
  - name: API_KEYS
    value: "sk-key1,sk-key2,sk-key3"
```

#### æ–¹æ¡ˆ 2: ä½¿ç”¨ Kubernetes Secretï¼ˆæ¨èï¼‰

```yaml
# åˆ›å»º Secret
apiVersion: v1
kind: Secret
metadata:
  name: api-keys
type: Opaque
stringData:
  keys: "sk-abc123,sk-def456,sk-ghi789"

---
# åœ¨ Deployment ä¸­å¼•ç”¨
env:
  - name: API_KEYS
    valueFrom:
      secretKeyRef:
        name: api-keys
        key: keys
```

#### æ–¹æ¡ˆ 3: Header è®¤è¯ï¼ˆæ›´æ ‡å‡†ï¼‰

```typescript
export const POST = async (req: Request) => {
  // ä» Header è¯»å– API key
  const apiKey = req.headers.get('X-API-Key') || 
                 req.headers.get('Authorization')?.replace('Bearer ', '');
  
  if (VALID_API_KEYS.length > 0) {
    if (!apiKey || !VALID_API_KEYS.includes(apiKey)) {
      return Response.json(
        { error: 'Unauthorized' },
        { status: 401 }
      );
    }
  }
  
  // ç»§ç»­å¤„ç†...
}
```

**ä½¿ç”¨æ–¹å¼**:

```bash
curl -X POST http://your-api/api/tavily \
  -H "X-API-Key: sk-your-key-here" \
  -H "Content-Type: application/json" \
  -d '{"query": "test"}'
```

### å…¬ç½‘å¼€æ”¾ + API Key éªŒè¯

å¦‚æœä½ æƒ³å°†æœåŠ¡å¼€æ”¾åˆ°å…¬ç½‘ï¼Œæµç¨‹æ˜¯ï¼š

#### æ­¥éª¤ 1: ä¿®æ”¹ Service ç±»å‹

```yaml
# k8s/deployment.yaml
apiVersion: v1
kind: Service
metadata:
  name: perplexica-service
spec:
  type: LoadBalancer  # æ”¹ä¸º LoadBalancer
  ports:
  - port: 80
    targetPort: 3000
```

#### æ­¥éª¤ 2: é…ç½® API Keys

```bash
kubectl create secret generic api-keys \
  --from-literal=keys="sk-key1,sk-key2,sk-key3"
```

#### æ­¥éª¤ 3: å®ç°éªŒè¯é€»è¾‘

ä½¿ç”¨ä¸Šé¢çš„æ–¹æ¡ˆ 1ã€2 æˆ– 3

#### æ­¥éª¤ 4: éƒ¨ç½²å¹¶è·å–å…¬ç½‘ IP

```bash
kubectl apply -f k8s/deployment.yaml
kubectl get svc perplexica-service

# è¾“å‡º
NAME                 TYPE           EXTERNAL-IP
perplexica-service   LoadBalancer   20.123.45.67
```

#### æ­¥éª¤ 5: å®¢æˆ·ç«¯è°ƒç”¨

```bash
curl -X POST http://20.123.45.67/api/tavily \
  -H "X-API-Key: sk-key1" \
  -d '{"query": "test"}'
```

### å®Œæ•´ç¤ºä¾‹å®ç°

æˆ‘å¯ä»¥å¸®ä½ åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ API Key éªŒè¯å®ç°å—ï¼ŸåŒ…æ‹¬ï¼š

1. âœ… ä»£ç ä¿®æ”¹
2. âœ… Kubernetes é…ç½®
3. âœ… Secret ç®¡ç†
4. âœ… æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

### å®‰å…¨å»ºè®®

å¦‚æœå¼€æ”¾åˆ°å…¬ç½‘ï¼Œè¿˜éœ€è¦è€ƒè™‘ï¼š

#### 1. HTTPS/SSL

```
ä½¿ç”¨ Ingress + cert-manager é…ç½® HTTPS
HTTP â†’ âŒ ä¸å®‰å…¨
HTTPS â†’ âœ… å®‰å…¨
```

#### 2. é€Ÿç‡é™åˆ¶

```typescript
// é˜²æ­¢æ»¥ç”¨
const rateLimiter = {
  'sk-key1': { limit: 100, period: '1h' },
  'sk-key2': { limit: 1000, period: '1h' },
};
```

#### 3. IP ç™½åå•ï¼ˆå¯é€‰ï¼‰

```yaml
# é™åˆ¶åªæœ‰ç‰¹å®š IP å¯ä»¥è®¿é—®
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: api-whitelist
spec:
  podSelector:
    matchLabels:
      app: perplexica
  ingress:
  - from:
    - ipBlock:
        cidr: 203.0.113.0/24  # ä½ çš„ IP æ®µ
```

#### 4. æ—¥å¿—å’Œç›‘æ§

```typescript
console.log('[API Auth]', {
  api_key: apiKey.substring(0, 8) + '***',
  ip: req.headers.get('x-forwarded-for'),
  timestamp: new Date().toISOString(),
  query: body.query
});
```

---

## ğŸ“Š æ€»ç»“

### ä½ çš„å››ä¸ªé—®é¢˜

| é—®é¢˜ | å½“å‰çŠ¶æ€ | å»ºè®® |
|------|---------|------|
| 1. `search_depth` | âš ï¸ æœªå®ç° | ä½¿ç”¨ `max_results` ä»£æ›¿ |
| 2. DuckDuckGo | âœ… å·²é›†æˆ | éšç§ä¿æŠ¤æœç´¢å¼•æ“ï¼Œé»˜è®¤å¯ç”¨ |
| 3. SafeSearch | âœ… å·²å®ç° | é»˜è®¤ä¸¥æ ¼æ¨¡å¼ï¼Œå¯è°ƒæ•´ |
| 4. `api_key` | âš ï¸ é¢„ç•™æœªå®ç° | å¯ä»¥å®ç°å…¬ç½‘è®¤è¯ |

### å¿«é€Ÿå‚è€ƒ

```json
{
  "query": "your search",
  "max_results": 20,        // æ§åˆ¶ç»“æœæ•°é‡ï¼ˆä»£æ›¿ search_depthï¼‰
  "engines": ["duckduckgo"], // åªç”¨éšç§æœç´¢
  "safesearch": 1,          // ä¸­ç­‰è¿‡æ»¤
  "api_key": "sk-xxx"       // æœªæ¥çš„è®¤è¯ï¼ˆç›®å‰ä¸éªŒè¯ï¼‰
}
```

---

## ğŸ’¡ éœ€è¦æˆ‘å¸®ä½ å®ç°ä»€ä¹ˆå—ï¼Ÿ

1. âœ… å®ç° `search_depth` çš„å®é™…åŠŸèƒ½ï¼Ÿ
2. âœ… å®ç° `api_key` éªŒè¯ç³»ç»Ÿï¼Ÿ
3. âœ… é…ç½®å…¬ç½‘è®¿é—® + è®¤è¯ï¼Ÿ
4. âœ… å…¶ä»–åŠŸèƒ½ï¼Ÿ

å‘Šè¯‰æˆ‘ä½ çš„éœ€æ±‚ï¼Œæˆ‘å¯ä»¥ç«‹å³å®ç°ï¼ğŸš€

---

**æ–‡æ¡£æ›´æ–°æ—¶é—´**: 2025-11-17  
**API ç‰ˆæœ¬**: v1.1

